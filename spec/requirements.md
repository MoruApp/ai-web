# Ai Web - Requirements (AIコンシェルジュ Webアプリ)

## 1. User Stories

### US-001: 社内手続き方法をすぐ調べたい

**As a** 一般社員  
**I want to** 社内手続きやルールを自然文で質問してすぐに回答を得たい  
**So that** 毎回総務・人事・情シスに問い合わせる手間を減らしたい

#### Acceptance Criteria (EARS形式)

1. **WHEN** 一般社員がログイン済みで質問入力欄に自然文で質問を送信したとき  
   **THE SYSTEM SHALL** 2秒以内にFAQ検索およびAI生成を組み合わせた回答候補を1件以上表示する

2. **WHEN** システムがFAQから該当する回答を特定できたとき  
   **THE SYSTEM SHALL** 回答本文とともに「参照元FAQタイトル」と「最終更新日」を表示する

3. **WHEN** システムがFAQに完全一致する回答を見つけられないが、類似FAQが存在するとき  
   **THE SYSTEM SHALL** AIによる推論回答とあわせて、類似FAQを最大3件まで「関連する質問」として表示する

4. **WHEN** システムが回答を生成できない、または信頼度が閾値[要確認]未満のとき  
   **THE SYSTEM SHALL** 「担当部署へのエスカレーションが必要です」等のメッセージを表示し、ユーザーに別の問い合わせ手段（メールアドレスまたは窓口情報[要確認]）を案内する

5. **WHILE** ユーザーの質問文が入力途中で一定時間（例：3秒[要確認]）以上停止している間  
   **THE SYSTEM SHALL** よくある質問のサジェスト（最大5件）を表示する

6. **WHEN** ユーザーがスマホ端末からアクセスしているとき  
   **THE SYSTEM SHALL** 質問入力欄と回答エリアが縦方向に最適化されたレイアウトで表示されるようレスポンシブに調整する

---

### US-002: 以前の質問履歴を見たい

**As a** 一般社員  
**I want to** 自分が過去に行った問い合わせとその回答を一覧で確認したい  
**So that** 同じ質問を何度もせずに自己解決できるようにしたい

#### Acceptance Criteria (EARS形式)

1. **WHEN** 一般社員がログイン後に「問い合わせ履歴」画面を開いたとき  
   **THE SYSTEM SHALL** ログインユーザー本人の過去の問い合わせを新しい順に1ページあたり20件[要確認]で一覧表示する

2. **WHILE** 問い合わせ履歴一覧が表示されている間  
   **THE SYSTEM SHALL** 質問文の一部、日付範囲（開始日・終了日）、カテゴリ[要確認]でのフィルタリング機能を提供する

3. **WHEN** ユーザーが履歴一覧の1件を選択したとき  
   **THE SYSTEM SHALL** その問い合わせの詳細画面を表示し、質問文、回答内容、回答日時、回答種別（FAQ/AI推論/エスカレーション）を表示する

4. **WHEN** ユーザーがスマホから問い合わせ履歴を閲覧するとき  
   **THE SYSTEM SHALL** 一覧表示をカード形式に切り替え、1カードに質問概要・日付・ステータスを表示する

---

### US-003: FAQを簡単に追加・編集したい

**As a** 管理者（人事・総務・情シス担当）  
**I want to** FAQをWeb画面から簡単に追加・編集・削除したい  
**So that** よくある質問への回答を標準化し、問い合わせ対応を減らしたい

#### Acceptance Criteria (EARS形式)

1. **WHEN** 管理者権限を持つユーザーが管理画面にログインしたとき  
   **THE SYSTEM SHALL** FAQ一覧画面へのナビゲーションを表示する

2. **WHEN** 管理者がFAQ一覧画面を開いたとき  
   **THE SYSTEM SHALL** FAQをタイトル、カテゴリ[要確認]、最終更新日、公開/非公開ステータスとともに一覧表示する

3. **WHEN** 管理者が「新規FAQ追加」ボタンを押下したとき  
   **THE SYSTEM SHALL** 質問文、回答文、カテゴリ[要確認]、公開/非公開、対象部署[要確認]を入力できるフォームを表示する

4. **WHEN** 管理者が必須項目（質問文・回答文）を入力して保存ボタンを押下したとき  
   **THE SYSTEM SHALL** 入力内容をバリデーションし、問題がなければFAQを登録し、一覧に即時反映する

5. **WHEN** 管理者が既存FAQの編集アイコンをクリックしたとき  
   **THE SYSTEM SHALL** 現在の内容を編集可能なフォームで表示し、更新履歴として更新日時と更新者を記録する

6. **WHEN** 管理者がFAQを削除しようとしたとき  
   **THE SYSTEM SHALL** 確認ダイアログを表示し、管理者が確認した場合のみ論理削除（非公開化）を行う

---

### US-004: AIの回答ログを確認したい

**As a** 管理者（人事・総務・情シス担当）  
**I want to** ユーザーの質問とAIの回答ログを確認したい  
**So that** 誤回答を把握し、FAQの改善やAIの調整に活かしたい

#### Acceptance Criteria (EARS形式)

1. **WHEN** 管理者が管理画面から「会話ログ」メニューを選択したとき  
   **THE SYSTEM SHALL** 期間指定（開始日・終了日）と部署[要確認]でフィルタ可能な会話ログ一覧を表示する

2. **WHILE** 会話ログ一覧が表示されている間  
   **THE SYSTEM SHALL** 各行に質問文の冒頭、回答の冒頭、日時、ユーザー部署[要確認]、回答種別（FAQ/AI推論/エスカレーション）を表示する

3. **WHEN** 管理者が特定の会話ログを選択したとき  
   **THE SYSTEM SHALL** その会話の全メッセージ履歴（ユーザー発話とシステム回答）を時系列で表示する

4. **WHEN** 管理者が「誤回答としてマーク」操作を行ったとき  
   **THE SYSTEM SHALL** 当該ログに誤回答フラグを付与し、誤回答一覧レポートに反映する

---

### US-005: 社内認証で安全にログインしたい

**As a** 社内ユーザー（一般社員・管理者）  
**I want to** 社内の認証基盤と連携してシングルサインオンでログインしたい  
**So that** 別途アカウントを作らずに安全に利用したい

#### Acceptance Criteria (EARS形式)

1. **WHEN** ユーザーがAIコンシェルジュのURLにアクセスしたとき  
   **THE SYSTEM SHALL** 社内認証基盤（SSO/SAML/OIDC等[要確認]）にリダイレクトし、認証済みであれば自動的にログイン状態とする

2. **WHEN** 認証基盤からユーザー情報（氏名、メールアドレス、部署、ロール情報[要確認]）が返却されたとき  
   **THE SYSTEM SHALL** その情報を用いてアプリ内ユーザープロファイルを作成または更新する

3. **WHEN** ユーザーが管理者ロールを持っていないとき  
   **THE SYSTEM SHALL** 管理画面メニューを表示せず、管理機能URLに直接アクセスされた場合はアクセス拒否メッセージを表示する

---

## 2. Functional Requirements

### FR-001: 社内FAQ検索・回答機能

- **WHEN** ユーザーが質問文を送信したとき  
- **THE SYSTEM SHALL** 社内FAQデータベースを全文検索し、関連度スコア上位N件（デフォルト5件[要確認]）を取得し、その中から最適な回答を選択またはAI回答生成のコンテキストとして利用する  
- **Priority**: High  
- **Notes**: FAQは部署・カテゴリでタグ付けされる想定

---

### FR-002: AIによる自然言語回答生成

- **WHEN** FAQ検索結果のみでは十分な回答が得られない、またはユーザー質問が複雑なとき  
- **THE SYSTEM SHALL** 大規模言語モデル[要確認]を用いて自然言語による回答を生成し、FAQ情報を優先的に参照するようプロンプト制御を行う  
- **Priority**: High  
- **Notes**: モデルは社内ネットワーク内またはセキュアなクラウド接続[要確認]

---

### FR-003: 回答信頼度判定とエスカレーション案内

- **WHEN** AIが生成した回答の信頼度スコアが事前定義した閾値[要確認]を下回るとき  
- **THE SYSTEM SHALL** 回答を「参考情報」として表示しつつ、担当部署への問い合わせ手段（メール/チケットシステムURL[要確認]）を案内する  
- **Priority**: Medium  
- **Notes**: 信頼度スコアの算出方法は別途設計

---

### FR-004: 問い合わせ履歴保存

- **WHEN** ユーザーが質問を送信し、システムが回答を返したとき  
- **THE SYSTEM SHALL** 質問文、回答内容、回答種別、回答日時、ユーザーID、部署、利用端末種別（PC/スマホ[要確認]）を履歴として保存する  
- **Priority**: High  
- **Notes**: 保存期間は最低1年間[要確認]

---

### FR-005: 問い合わせ履歴閲覧（ユーザー向け）

- **WHEN** ログインユーザーが「問い合わせ履歴」画面を開いたとき  
- **THE SYSTEM SHALL** 当該ユーザーの履歴のみを検索し、ページング付きで一覧表示する  
- **Priority**: High  
- **Notes**: 他ユーザーの履歴は閲覧不可

---

### FR-006: FAQ管理（追加・編集・削除）

- **WHEN** 管理者がFAQ管理画面から登録・更新・削除操作を行ったとき  
- **THE SYSTEM SHALL** 入力内容をバリデーションし、FAQテーブルに対して作成・更新・論理削除を実行する  
- **Priority**: High  
- **Notes**: 削除は論理削除とし、過去ログの参照整合性を保つ

---

### FR-007: FAQ公開/非公開制御

- **WHEN** 管理者がFAQの公開ステータスを変更したとき  
- **THE SYSTEM SHALL** 公開中FAQのみを一般ユーザーの検索対象とし、非公開FAQは管理画面からのみ閲覧可能とする  
- **Priority**: Medium  
- **Notes**: 下書き状態のFAQ作成を想定

---

### FR-008: 会話ログ閲覧（管理者向け）

- **WHEN** 管理者が会話ログ画面を開いたとき  
- **THE SYSTEM SHALL** 指定期間内の全ユーザーの会話ログを検索し、フィルタ・ソート機能付きで一覧表示する  
- **Priority**: High  
- **Notes**: 個人情報のマスキング要否[要確認]

---

### FR-009: 誤回答マーキング

- **WHEN** 管理者が会話ログ詳細画面で「誤回答としてマーク」操作を行ったとき  
- **THE SYSTEM SHALL** 当該ログに誤回答フラグとコメント[要確認]を保存し、誤回答レポートに集計する  
- **Priority**: Medium  
- **Notes**: 将来的な自動改善機能の基礎データ

---

### FR-010: 回答精度の自動改善（WANT）

- **WHEN** 一定期間ごと（例：1日1回[要確認]）にバッチ処理が実行されるとき  
- **THE SYSTEM SHALL** 誤回答フラグ付きログおよびユーザー評価[要確認]を分析し、FAQの改善候補やAIプロンプト調整候補をレポートとして管理者に提示する  
- **Priority**: Low  
- **Notes**: 初期MVPではレポート提示のみ、自動反映は将来対応

---

### FR-011: 質問カテゴリー自動分類（WANT）

- **WHEN** ユーザーが新規質問を送信したとき  
- **THE SYSTEM SHALL** AIモデルを用いて質問をカテゴリ（総務/IT/人事など）に自動分類し、履歴およびログにカテゴリ情報を付与する  
- **Priority**: Low  
- **Notes**: カテゴリラベルは管理画面から編集可能とする[要確認]

---

### FR-012: ログイン（社内認証連携）

- **WHEN** 未認証ユーザーがアプリにアクセスしたとき  
- **THE SYSTEM SHALL** 社内認証基盤にリダイレクトし、認証後にユーザー情報を受け取りセッションを開始する  
- **Priority**: High  
- **Notes**: SSO方式の詳細はインフラ担当と要調整[要確認]

---

### FR-013: 権限管理

- **WHEN** ユーザーが管理者専用機能（FAQ管理、会話ログ閲覧等）にアクセスしようとしたとき  
- **THE SYSTEM SHALL** ユーザーのロール情報を確認し、管理者ロールを持たない場合はアクセスを拒否する  
- **Priority**: High  
- **Notes**: ロールは認証基盤連携またはアプリ内で付与[要確認]

---

### FR-014: レスポンシブUI

- **WHEN** ユーザーがPCまたはスマホからアクセスしたとき  
- **THE SYSTEM SHALL** 画面幅に応じてレイアウトを自動調整し、主要機能（質問入力、回答表示、履歴閲覧）がスクロールのみで利用可能となるようにする  
- **Priority**: High  
- **Notes**: タブレット対応方針[要確認]

---

### FR-015: 利用マニュアル（簡易版）

- **WHEN** ユーザーがヘルプまたは使い方リンクをクリックしたとき  
- **THE SYSTEM SHALL** Web上で閲覧可能な簡易マニュアル（基本的な使い方Q&A）を表示する  
- **Priority**: Medium  
- **Notes**: 初期版はテキスト中心、将来スクリーンショット追加

---

## 3. Non-Functional Requirements

### NFR-001: Performance（応答性能）

- **WHILE** 通常利用時の同時接続ユーザー数が想定最大値（例：100ユーザー[要確認]）以下の間  
- **THE SYSTEM SHALL** 95%のリクエストに対して2秒以内に初回応答を返す

---

### NFR-002: Security（セキュリティ）

- **THE SYSTEM SHALL** すべての通信をHTTPSで暗号化し、TLS1.2以上を利用する  
- **THE SYSTEM SHALL** 認証・認可に社内認証基盤を利用し、アプリ側ではパスワードを保持しない  
- **THE SYSTEM SHALL** 会話ログおよびFAQデータを社内ネットワーク内のサーバまたは社内指定クラウド環境に保存する

---

### NFR-003: Availability（可用性）

- **WHILE** 平日日中のサービス提供時間帯（例：9:00〜18:00[要確認]）の間  
- **THE SYSTEM SHALL** 月間稼働率99.9%以上を維持する

---

### NFR-004: Network Scope（利用範囲）

- **THE SYSTEM SHALL** 社内ネットワーク内からのアクセスのみを許可し、インターネットからの直接アクセスを拒否する

---

### NFR-005: Usability（ユーザビリティ）

- **WHEN** 新規ユーザーが初めてシステムを利用するとき  
- **THE SYSTEM SHALL** 3クリック以内で質問入力画面に到達できるようナビゲーションを設計する

---

### NFR-006: Maintainability（保守性）

- **THE SYSTEM SHALL** FAQデータおよび会話ログのバックアップを1日1回以上自動取得し、最低30日間[要確認]保管する  
- **THE SYSTEM SHALL** アプリケーションログを出力し、エラー発生時に原因追跡が可能なレベルの情報（リクエストID、ユーザーID[要確認]等）を記録する

---

### NFR-007: Privacy（プライバシー）

- **WHEN** 会話ログが保存されるとき  
- **THE SYSTEM SHALL** 個人情報に該当する可能性のある項目の取り扱いについて社内規程に準拠し、必要に応じてマスキングまたは削除機能を提供する[要確認]

---

### NFR-008: Scalability（拡張性）

- **WHILE** 利用ユーザー数が増加した場合  
- **THE SYSTEM SHALL** アプリケーションサーバおよびAI推論基盤を水平スケールできる構成（コンテナ化やクラウドスケール機能[要確認]）を採用する

---

### NFR-009: Logging & Monitoring（監視）

- **THE SYSTEM SHALL** 応答時間、エラー率、AI呼び出し回数等のメトリクスを収集し、ダッシュボードで可視化できるようにする[要確認]  
- **THE SYSTEM SHALL** 異常なエラー率やレスポンス遅延が検知されたとき、運用担当にアラート通知を行う[要確認]

---

※ [要確認] が付いている項目は、関係者との追加ヒアリング・設計検討が必要な未確定要素です。